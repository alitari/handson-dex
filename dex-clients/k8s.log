apiVersion: v1
kind: Service
metadata:
  labels:
    app.kubernetes.io/name: dex-client-oidconsumer
  name: dex-client-oidconsumer
spec:
  ports:
  - name: callback
    port: 5555
    targetPort: callback
  selector:
    app.kubernetes.io/name: dex-client-oidconsumer
  type: ClusterIP
---
apiVersion: apps/v1
kind: Deployment
metadata:
  labels:
    app.kubernetes.io/name: dex-client-oidconsumer
  name: dex-client-oidconsumer
spec:
  replicas: 1
  selector:
    matchLabels:
      app.kubernetes.io/name: dex-client-oidconsumer
  template:
    metadata:
      labels:
        app.kubernetes.io/name: dex-client-oidconsumer
    spec:
      containers:
      - args:
        - --issuer
        - http://dex.11.22.33.44.xip.io/dex
        name: dex-client-oidconsumer
      - image: alitari/dex-client-oidconsumer:latest
        imagePullPolicy: Always
        name: dex-client
        ports:
        - containerPort: 5555
          name: callback
---
apiVersion: extensions/v1beta1
kind: Ingress
metadata:
  annotations:
    kubernetes.io/ingress.class: kong
  labels:
    app.kubernetes.io/name: dex-client-oidconsumer
  name: dex-client-oidconsumer-oidconsumer
spec:
  rules:
  - host: dex-client-oidconsumer.11.22.33.44.xip.io
    http:
      paths:
      - backend:
          serviceName: dex-client-oidconsumer
          servicePort: 5555
        path: /
